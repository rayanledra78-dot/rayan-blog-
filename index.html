<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Spin & Win ğŸ’</title>
<style>
:root{--bg1:#1e3c72;--bg2:#2a5298}
html, body{margin:0;padding:0;overflow:hidden;height:100%;width:100%;}
body{font-family:"Cairo",sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center;}
h1{margin:10px 0 6px 0;font-size:26px}
.wheel-wrap{position:relative;width:340px;height:340px;margin:12px}
canvas#wheel{width:100%;height:100%;border-radius:50%;box-shadow:0 8px 30px rgba(0,0,0,0.4)}
.pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%) rotate(180deg);width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;border-top:28px solid #ffd54f;filter:drop-shadow(0 3px 4px rgba(0,0,0,0.3));}
#spinBtn,#claimBtn,#withdrawBtnGame{margin-top:14px;padding:12px 30px;border-radius:10px;border:none;font-weight:700;font-size:18px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.2);}
#spinBtn{background:#ffcc00;color:#222;}
#claimBtn{background:#ffcc00;color:#222;}
#withdrawBtnGame{background:#4caf50;color:#fff;}
#withdrawBtnGame{position: fixed;top:16px;left:16px;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;padding:0;box-shadow:0 6px 18px rgba(0,0,0,0.3);z-index:1000;}
#spinBtn:active,#claimBtn:active,#withdrawBtnGame:active{transform:translateY(1px)}
#claimBtn.hidden{display:none}
.popup{position:fixed;inset:0;background:rgba(0,0,0,0.72);display:flex;align-items:center;justify-content:center;padding:20px;z-index:2000;visibility:hidden;opacity:0;transition:opacity .18s;}
.popup.show{visibility:visible;opacity:1}
.popup-box{background:#232323;padding:18px;border-radius:12px;min-width:260px;color:#fff;text-align:center}
.popup-box h2{margin:0 0 8px 0}
.popup-box p{margin:0 0 10px 0;color:#ddd}
.popup-box button{margin-top:8px;padding:10px 16px;border-radius:8px;border:none;background:#ffd54f;color:#222;font-weight:700;cursor:pointer}
.points-badge{position:fixed;right:16px;top:16px;background:rgba(0,0,0,0.35);padding:8px 12px;border-radius:999px;font-weight:700;}
.confetti{position:fixed;pointer-events:none;z-index:1500}
</style>
</head>
<body>
<h1>ğŸ¡ Spin & Win</h1>
<div class="wheel-wrap">
  <div class="pointer" aria-hidden="true"></div>
  <canvas id="wheel" width="340" height="340" role="img" aria-label="Wheel"></canvas>
</div>

<button id="spinBtn">Spin and Win</button>
<button id="claimBtn" class="hidden">Ø§Ø­ØµØ¯ Ù†Ù‚Ø§Ø·Ùƒ ğŸ¬</button>
<button id="withdrawBtnGame">ğŸ’°</button>

<div class="points-badge" id="pointsBadge">Ù†Ù‚Ø§Ø·Ùƒ: 0</div>

<!-- Popups -->
<div id="errorPopup" class="popup">
  <div class="popup-box">
    <h2>âŒ Ø®Ø·Ø£</h2>
    <p>Ù„Ù… ØªØ´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</p>
    <div style="display:flex;gap:8px;justify-content:center">
      <button id="retryAdBtn">Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
      <button id="closeErrBtn" style="background:#ff6b6b;color:white">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<div id="withdrawPopup" class="popup">
  <div class="popup-box">
    <h2>Ø´Ø±ÙˆØ· Ø§Ù„Ø³Ø­Ø¨</h2>
    <p>1. 10000ğŸ’ ğŸ”„ 1USD<br>
       2. Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹<br>
       3. Ø§Ù…ØªÙ„Ø§Ùƒ Ø­Ø³Ø§Ø¨ PayPal (Ù„ÙŠØ³ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)<br>
       4. Ù…ØªÙˆÙØ± Flexy Ù„ÙƒÙ„ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</p>
    <button id="confirmWithdrawBtn">Ø³Ø­Ø¨ ğŸ”„</button>
  </div>
</div>

<div id="toast" class="popup">
  <div class="popup-box" id="toastBox" style="min-width:200px"></div>
</div>

<script>
const BLOG_LINK = "https://rayanwebsite.blogspot.com/2025/10/body-background-linear-gradient135deg.html";
const MIN_WATCH_MS = 20000;
const BIG_REWARD = 100;
const SMALL_REWARD = 10;

// Canvas wheel setup
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const spinBtn = document.getElementById('spinBtn');
const claimBtn = document.getElementById('claimBtn');
const pointsBadge = document.getElementById('pointsBadge');
const errorPopup = document.getElementById('errorPopup');
const retryAdBtn = document.getElementById('retryAdBtn');
const closeErrBtn = document.getElementById('closeErrBtn');
const toast = document.getElementById('toast');
const toastBox = document.getElementById('toastBox');
const withdrawBtnGame = document.getElementById('withdrawBtnGame');
const withdrawPopup = document.getElementById('withdrawPopup');
const confirmWithdrawBtn = document.getElementById('confirmWithdrawBtn');

let points = Number(localStorage.getItem('app_points') || 0);
function updatePointsUI(){ pointsBadge.textContent = "Ù†Ù‚Ø§Ø·Ùƒ: "+points; localStorage.setItem('app_points', points); }
updatePointsUI();

// Wheel setup
const slices = 20;
const bigIndices = [3,7,15,19];
const smallIndices = Array.from({length:20},(_,i)=>i).filter(i=>!bigIndices.includes(i));
const colors = ["#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f","#ff8a65","#ffd54f"];
const labels = Array(slices).fill("").map((_,i)=> bigIndices.includes(i) ? "100 ğŸ’" : "10 ğŸ’");

function drawWheel(){
  const centerX = canvas.width/2, centerY = canvas.height/2, radius = Math.min(centerX,centerY);
  const arc = (2*Math.PI)/slices;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<slices;i++){
    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.fillStyle = colors[i % colors.length];
    ctx.arc(centerX,centerY,radius,i*arc,(i+1)*arc);
    ctx.lineTo(centerX,centerY);
    ctx.fill();
    ctx.save();
    ctx.translate(centerX,centerY);
    ctx.rotate(i*arc + arc/2);
    ctx.textAlign = "right";
    ctx.fillStyle="#111";
    ctx.font="bold 18px sans-serif";
    ctx.fillText(labels[i],radius-18,8);
    ctx.restore();
  }
}
drawWheel();

// Wheel spinning
let isSpinning=false;
const wheelElem=canvas;
function pickIndexByProbability(){
  return Math.random()<0.01 ? bigIndices[Math.floor(Math.random()*bigIndices.length)] : smallIndices[Math.floor(Math.random()*smallIndices.length)];
}
function degToCss(deg){ return `rotate(${deg}deg)`; }

spinBtn.addEventListener('click',()=>{
  if(isSpinning) return;
  isSpinning=true;
  claimBtn.classList.add('hidden');
  spinBtn.disabled=true;

  const selected = pickIndexByProbability();
  const anglePer = 360/slices;
  const stopAngle = 360 - (selected*anglePer + anglePer/2);
  const rotations = 9+Math.floor(Math.random()*3);
  const finalAngle = rotations*360 + stopAngle;

  let vibrationInterval;
  if(navigator.vibrate){
    vibrationInterval=setInterval(()=>navigator.vibrate(100),200);
  }

  wheelElem.style.transition="transform 5s cubic-bezier(.18,.9,.12,1)";
  wheelElem.style.transform = degToCss(finalAngle);

  const onEnd = ()=>{
    wheelElem.style.transition="none";
    const normalized = finalAngle%360;
    wheelElem.style.transform=degToCss(normalized);

    if(navigator.vibrate){clearInterval(vibrationInterval); navigator.vibrate(0);}

    isSpinning=false;
    spinBtn.disabled=false;

    if(bigIndices.includes(selected)){
      addPoints(BIG_REWARD);
      showConfetti();
      showToast("ğŸ‰ ÙØ²Øª 100 ğŸ’!");
    }else{
      claimBtn.classList.remove('hidden');
      claimBtn.dataset.reward=SMALL_REWARD;
      showConfetti();
      showToast("Ø§Ø¶ØºØ· Ø§Ø­ØµØ¯ Ù†Ù‚Ø§Ø·Ùƒ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ 10 ğŸ’");
    }
    wheelElem.removeEventListener('transitionend',onEnd);
  };
  wheelElem.addEventListener('transitionend',onEnd);
});

// Points
function addPoints(n){ points=Number(points)+Number(n); updatePointsUI(); }

// Toast
function showToast(msg,duration=1800){ toastBox.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),duration); }

// Error popup
function showErrorPopup(){ errorPopup.classList.add('show'); }
function hideErrorPopup(){ errorPopup.classList.remove('show'); }

// Claim button opens blog
claimBtn.addEventListener('click',()=>{
  claimBtn.classList.add('hidden');
  const reward=Number(claimBtn.dataset.reward||SMALL_REWARD);
  const a=document.createElement('a');
  a.href=BLOG_LINK;
  a.target='_blank';
  a.rel='noopener noreferrer';
  a.click();
  const start=Date.now();
  localStorage.setItem('adStart',String(start));
  localStorage.setItem('adReward',String(reward));
});

// Handle ad return
function handleAdReturn(){
  const adStart = Number(localStorage.getItem('adStart')||0);
  const reward = Number(localStorage.getItem('adReward')||0);
  if(!adStart||!reward) return;
  const elapsed = Date.now()-adStart;
  localStorage.removeItem('adStart');
  localStorage.removeItem('adReward');
  if(elapsed>=MIN_WATCH_MS){
    addPoints(reward);
    showToast(`ğŸ‰ ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${reward} ğŸ’ Ø¨Ù†Ø¬Ø§Ø­!`);
    claimBtn.classList.add('hidden');
  }else showErrorPopup();
}
window.addEventListener('load',()=>{if(localStorage.getItem('adStart')) setTimeout(handleAdReturn,400);});
document.addEventListener('visibilitychange',()=>{if(document.visibilityState==='visible'){if(localStorage.getItem('adStart')) setTimeout(handleAdReturn,300);}});

// Retry ad
retryAdBtn.addEventListener('click',()=>{hideErrorPopup(); const a=document.createElement('a'); a.href=BLOG_LINK; a.target='_blank'; a.rel='noopener noreferrer'; a.click();});
closeErrBtn.addEventListener('click',hideErrorPopup);

// Confetti effect
function showConfetti(){
  const confetti = document.createElement('div');
  confetti.className='confetti';
  document.body.appendChild(confetti);
  confetti.style.left=Math.random()*window.innerWidth+'px';
  confetti.style.top='0px';
  confetti.style.width='8px';
  confetti.style.height='8px';
  confetti.style.background=['#ffd54f','#ff8a65','#ff6b6b','#4caf50','#2196f3'][Math.floor(Math.random()*5)];
  confetti.style.position='fixed';
  confetti.style.borderRadius='50%';
  confetti.style.opacity='1';
  let fall=0;
  const interval=setInterval(()=>{
    fall+=4;
    confetti.style.top=fall+'px';
    if(fall>window.innerHeight){clearInterval(interval); confetti.remove();}
  },16);
}

// Withdraw button
withdrawBtnGame.addEventListener('click',()=>{withdrawPopup.classList.add('show');});
confirmWithdrawBtn.addEventListener('click',()=>{window.open('https://www.tiktok.com/@rayan.website?_t=ZS-90HwlEMhpTu&_r=1','_blank'); withdrawPopup.classList.remove('show');});
</script>
</body>
</html>